/* =============================================================== */
/* RESPONSIVE TYPOGRAPHY SYSTEM                                   */
/* =============================================================== */

:root {
  /* Base font scale */
  --font-scale-xs: 0.85;
  --font-scale-sm: 0.92;
  --font-scale-md: 1;
  --font-scale-lg: 1.08;
  --font-scale-xl: 1.15;

  /* Semantic sizes */
  --fs-display: calc(2.5rem * var(--font-scale-md));
  --fs-title: calc(1.75rem * var(--font-scale-md));
  --fs-subtitle: calc(1.25rem * var(--font-scale-md));
  --fs-body: calc(1rem * var(--font-scale-md));
  --fs-small: calc(1.5em * var(--font-scale-md));
  --fs-tiny: calc(1.4em * var(--font-scale-md));

  /* Line heights */
  --lh-tight: 1.1;
  --lh-normal: 1.4;
  --lh-relaxed: 1.6;

  /* Component variations */
  --header-title-size: var(--fs-title);
  --chat-message-size: calc(1rem * var(--chat-font-scale));
  --chat-sender-size: var(--fs-small);
  --chat-date-size: var(--fs-tiny);
  --chat-header-height: 5em;


  /* Layout responsive units */
  --layout-gap: .4rem;
  --layout-gap-md: 1.25rem;
  --layout-gap-lg: 1.5rem;

  --container-max: 1440px;
  --sidebar-width-desktop: 26rem;
  --sidebar-width-tablet: 20rem;
  --sidebar-width-mobile: 16rem;
  --sidebar-width: var(--sidebar-width-desktop);
}

/* RESPONSIVE BREAKPOINT BASED VARIABLE OVERRIDES */

@media (max-width: 1024px) {
  :root {
    --font-scale-md: var(--font-scale-sm);
    --layout-gap: var(--layout-gap-md);
  }
}

@media (max-width: 768px) {
  :root {
    --font-scale-md: var(--font-scale-xs);
    --sidebar-width: var(--sidebar-width-tablet);
  }
}

@media (max-width: 480px) {
  :root {
    --font-scale-md: var(--font-scale-xs);
    --sidebar-width: var(--sidebar-width-mobile);
  }
}

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ========================================================================== */
/* ROOT VARIABLES & GLOBAL BASE                                            */
/* ========================================================================== */

@layer base {
  :root {
    /* Light theme */
    --room-text: 224 71.4% 4.1%;                 /* Normal text */
    --room-text-active: 262.1 83.3% 57.8%;       /* Primary color when active */

    --message-text-color: 224 71.4% 4.1%; /* Same as foreground */
    --message-text-size: 1.22em; /* Your existing text size */
    --message-sender-color: 224 71.4% 4.1%; /* Same as foreground */
    --message-sender-size: 0.875rem; /* 14px for sender name */
    --message-date-color: 220 8.9% 46.1%; /* Same as muted-foreground */
    --message-date-size: 0.75rem; /* 12px for date */
    --no-messages-color: 220 8.9% 46.1%; /* Same as muted-foreground */
    --no-messages-size: 1em;
    --background: 0 0% 100%;
    --foreground: 224 71.4% 4.1%;
    --card: 0 0% 100%;
    --card-foreground: 224 71.4% 4.1%;
    --popover: 0 0% 100%;
    --popover-foreground: 224 71.4% 4.1%;
    --primary: 262.1 83.3% 57.8%;
    --primary-foreground: 210 20% 98%;
    --secondary: 220 14.3% 95.9%;
    --secondary-foreground: 220.9 39.3% 11%;
    --muted: 220 14.3% 95.9%;
    --muted-foreground: 220 8.9% 46.1%;
    --accent: 220 14.3% 95.9%;
    --accent-foreground: 220.9 39.3% 11%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 20% 98%;
    --border: 220 13% 91%;
    --input: 220 13% 91%;
    --ring: 262.1 83.3% 57.8%;
    --radius: 0.5rem;
    --sidebar-width-icon: 3rem;
    --text-color-sidebar: #fff;
    --z-mask: 0; /* mask under UI by default */
    --z-ui: 10;  /* main UI z-level */
    --z-overlay: 20; /* popovers, modals that should sit above core UI */
    --z-top: 50; /* toasts/alerts that must always be on top */
    --text-color: 224 71.4% 4.1%; /* Change from #000 to HSL format */
    --text-size: 4em;
    --action-bg: hsl(240 80% 95%);
    --action-hover: hsl(240 100% 88%);
    --action-active: hsl(240 70% 60%);
    --action-ring: hsl(240 80% 70%);
    --action-text: hsl(240 30% 25%);
    --sidebar-background: hsl(240, 60%, 96%);     /* Softer, warmer light blue-gray */
    --sidebar-foreground: 240, 10%, 20%;         /* Deep readable text */
    --sidebar-primary: 240, 80%, 45%;             /* Vibrant blue for active states */
    --sidebar-primary-foreground: 0, 0%, 100%;    /* Pure white on active */
    --sidebar-accent: 240, 50%, 92%;              /* Subtle hover background */
    --sidebar-accent-foreground: 240, 10%, 15%;   /* Strong text on hover */
    --sidebar-border: 240, 30%, 88%;              /* Soft divider */
    --sidebar-ring: 217.2 91.2% 59.8%;
    /* ── FONT & TEXT ── */
    --app-font-scale: 1;                    /* Global font multiplier */
    --chat-font-scale: 1.1;                 /* Chat messages only */
    --font-family-base: "Inter", system-ui, sans-serif;
    --font-family-mono: "Geist Mono", monospace;

    /* ── LAYOUT & SPACING ── */
    --spacing-unit: 1rem;                   /* Base for padding/margin/gap */
    --radius-unit: 0.5rem;                  /* Base border-radius */
    --sidebar-width-collapsed: 5rem;
    --header-height: 4em;
    --chat-input-height: 4rem;

    /* ── VISUAL DENSITY PRESETS ── */
    --density-padding: .31rem;
    --density-gap: 0.75rem;
    --density-radius: 0.5rem;

    /* ── GLASSMORPHISM & EFFECTS ── */
    --glass-opacity: 0.75;
    --glass-blur: 16px;
    --glass-saturate: 150%;
    --border-opacity: 0.15;
    --shadow-strength: 0.12;

    /* ── MESSAGE BUBBLES ── */
    --message-bubble-radius: 1.25rem;
    --message-bubble-padding: 0.75rem 1rem;
    --message-sender-size: 0.875rem;
    --message-date-size: 0.75rem;
    --message-gap: 0.5rem;

    /* ── ANIMATIONS & MOTION ── */
    --motion-duration: 200ms;
    --motion-easing: cubic-bezier(0.2, 0, 0, 1);
    --motion-reduced: false; /* set via data-reduced-motion */
    --tab-bg: hsl(var(--muted) / 0.45);           /* container background */
    --tab-active-bg: hsl(var(--action-active) / 0.20);
    --tab-active-text: hsl(var(--room-text-active));
    --tab-text: hsl(var(--room-text));
    --tab-height: 2.6rem;       /* default height */
    --tab-radius: .6rem; 
    /* ── CUSTOM BRAND & ACCENT ── */
    --brand-hue: 262;
    --brand-saturation: 83%;
    --brand-lightness: 58%;
    --results-height: 55vh;
    --results-height-sm: 80vh;
    --results-height-lg: 78vh;
    /* ── CUSTOM COLORS (override primary) ── */
    --custom-primary: hsl(var(--brand-hue), var(--brand-saturation), var(--brand-lightness));
  }

  .dark {
    --tab-height: 2.6rem;
    --tab-radius: .6rem;
    /* Dark theme */
    --room-text: 217.9 10.6% 64.9%;              /* Muted foreground */
    --room-text-active: 263.4 70% 50.4%;         /* Primary accent */
    --message-text-color: 210 20% 98%; /* Same as foreground */
    --message-text-size: 1.22em; /* Your existing text size */
    --message-sender-color: 210 20% 98%; /* Same as foreground */
    --message-sender-size: 0.875rem; /* 14px for sender name */
    --message-date-color: 217.9 10.6% 64.9%; /* Same as muted-foreground */
    --message-date-size: 0.75rem; /* 12px for date */
    --no-messages-color: 217.9 10.6% 64.9%; /* Same as muted-foreground */
    --no-messages-size: 1em;
    --background: 224 71.4% 4.1%;
    --foreground: 210 20% 98%;
    --card: 224 71.4% 4.1%;
    --card-foreground: 210 20% 98%;
    --popover: 224 71.4% 4.1%;
    --popover-foreground: 210 20% 98%;
    --primary: 263.4 70% 50.4%;
    --primary-foreground: 210 20% 98%;
    --secondary: 215 27.9% 16.9%;
    --secondary-foreground: 210 20% 98%;
    --muted: 215 27.9% 16.9%;
    --muted-foreground: 217.9 10.6% 64.9%;
    --accent: 215 27.9% 16.9%;
    --accent-foreground: 210 20% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 20% 98%;
    --border: 215 27.9% 16.9%;
    --input: 215 27.9% 16.9%;
    --ring: 263.4 70% 50.4%;
    --text-color: 210 20% 98%; /* Change from #fff to HSL format */
    --text-size: 4em;
    --sidebar-width-icon: 3rem;
    --z-mask: 0; /* mask under UI by default */
    --z-ui: 10;  /* main UI z-level */
    --z-overlay: 20; /* popovers, modals that should sit above core UI */
    --z-top: 50; /* toasts/alerts that must always be on top */
    --text-color-sidebar: #fff;
    --tab-bg: hsl(var(--muted) / 0.25);
    --tab-active-bg: hsl(var(--action-active) / 0.28);
    --tab-active-text: hsl(var(--room-text-active));
    --tab-text: hsl(var(--room-text));
    --action-bg: hsl(240 35% 20%);
    --action-hover: hsl(240 50% 25%);
    --action-active: hsl(240 90% 70%);
    --action-ring: hsl(240 100% 80%);
    --action-text: hsl(0 0% 98%);
    --sidebar-background: hsl(240, 25%, 8%);      /* Deep blue-black (not pure black = easier on eyes) */
    --sidebar-foreground: 240, 15%, 94%;          /* Crisp off-white */
    --sidebar-primary: 240, 90%, 65%;             /* Electric blue accent (pops beautifully) */
    --sidebar-primary-foreground: 240, 10%, 10%;  /* Near-black for perfect contrast on active */
    --sidebar-accent: 240, 20%, 14%;              /* Slightly lighter than bg for depth */
    --sidebar-accent-foreground: 240, 15%, 90%;   /* Bright text on hover */
    --sidebar-border: 240, 15%, 18%;
    --sidebar-ring: 217.2 91.2% 59.8%;
    --app-font-scale: 1;
    --chat-font-scale: 1.1;
    --spacing-unit: 1rem;
    --radius-unit: 0.5rem;
    --glass-opacity: 0.7;
    --glass-blur: 20px;
    --border-opacity: 0.25;
    --shadow-strength: 0.3;

    --brand-hue: 263;
    --brand-saturation: 90%;
    --brand-lightness: 65%;
  }
}
@media (max-width: 768px) {
  :root {
    --results-height: var(--results-height-sm);
  }
}

@media (min-width: 1024px) {
  :root {
    --results-height: var(--results-height-lg);
  }
}

@media (max-width: 768px) {
  :root {
    --tab-height: 2.35rem;
  }
}
@media (max-width: 480px) {
  :root {
    --tab-height: 2.15rem;
  }
}
@layer utilities {
  
  /* Dynamic spacing */
  .p-dynamic { padding: var(--spacing-unit); }
  .px-dynamic { padding-left: var(--spacing-unit); padding-right: var(--spacing-unit); }
  .py-dynamic { padding-top: var(--spacing-unit); padding-bottom: var(--spacing-unit); }
  .m-dynamic { margin: var(--spacing-unit); }
  .gap-dynamic { gap: var(--spacing-unit); }
  [data-state="active"] {
    transition:
      background-color var(--motion-duration) var(--motion-easing),
      color var(--motion-duration) var(--motion-easing),
      font-weight var(--motion-duration) var(--motion-easing);
  }
  
  /* Dynamic radius */
  .rounded-dynamic { border-radius: var(--radius-unit); }
  .rounded-lg-dynamic { border-radius: calc(var(--radius-unit) * 1.5); }
  .rounded-xl-dynamic { border-radius: calc(var(--radius-unit) * 2); }

  /* Message bubble styling */
  .message-bubble {
    border-radius: var(--message-bubble-radius);
    padding: var(--message-bubble-padding);
    gap: var(--message-gap);
  }
  .message-bubble:first-child { border-top-left-radius: 0.5rem; }
  .message-bubble:last-child { border-bottom-right-radius: 0.5rem; }

  /* Glass effect (used in headers, buttons, popovers) */
  .glass {
    background: hsl(var(--background) / var(--glass-opacity));
    backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturate));
    border: 1px solid hsl(var(--border) / var(--border-opacity));
    box-shadow: 0 8px 32px hsl(0 0% 0% / var(--shadow-strength));
  }

  /* Dynamic transitions */
  .transition-dynamic {
    transition: 
      all var(--motion-duration) var(--motion-easing),
      opacity 150ms,
      transform 150ms;
  }

  /* Custom primary color override */
  .bg-primary-dynamic { background-color: var(--custom-primary); }
  .text-primary-dynamic { color: var(--custom-primary); }
  .border-primary-dynamic { border-color: var(--custom-primary); }

  /* Font scale helpers */
  .text-chat { font-size: calc(1rem * var(--chat-font-scale)); }

  /* Remove ALL focus outlines from Radix DropdownMenu components */
  [data-radix-dropdown-menu-trigger]:focus,
  [data-radix-dropdown-menu-trigger]:focus-visible,
  [data-radix-popup-content]:focus,
  [data-radix-popup-content]:focus-visible,
  [data-radix-dropdown-menu-item]:focus,
  [data-radix-dropdown-menu-item]:focus-visible,
  [data-radix-dropdown-menu-subtrigger]:focus,
  [data-radix-dropdown-menu-subtrigger]:focus-visible {
    outline: none !important;
    box-shadow: none !important;
    border: none !important;
  }
  
  .no-focus {
    outline: none !important;
    box-shadow: none !important;
  }

  .text-room {
    color: hsl(var(--room-text));
  }
  
  .text-room-active {
    color: hsl(var(--room-text-active));
  }
  
  .text-custom-size {
    font-size: var(--text-size);
  }
  
  .text-custom-color {
    color: hsl(var(--text-color));
  }
  
  .sidebar-background {
    background-color: var(--sidebar-background);
  }
  
  .sidebar-text {
    color: var(--text-color-sidebar);
  }
}

@layer base {
  body {
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
    font-feature-settings: "rlig" 1, "calt" 1;

    /* Fix drawer movement on mobile keyboard */
    height: 100vh;
    min-height: 100vh;
    max-height: 100vh;
    position: fixed;
    width: 100%;
    overflow: hidden;

    transition: background-color 0.3s ease, color 0.3s ease;
  }

  /* Responsive base font */
  html {
    font-size: 16px;
    height: 100%;
    scroll-behavior: smooth;
  }

  @media (max-width: 768px) {
    html {
      font-size: 14px;
    }
  }

  @media (max-width: 480px) {
    html {
      font-size: 13px;
    }
  }

  /* Focus-visible */
  *:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 2px;
    border-radius: calc(var(--radius) - 2px);
  }

  ::selection {
    background-color: hsl(var(--primary) / 0.2);
    color: hsl(var(--foreground));
  }

  /* Removed universal transition to prevent performance issues and conflict with JS animations */
  * {
    border-color: hsl(var(--border));
  }
}

/* ========================================================================== */
/* SCROLLBAR STYLES                                                          */
/* ========================================================================== */

@layer utilities {
  /* Scroll containment */
  .scroll-container {
    overscroll-behavior: contain;
  }

  /* Hide scrollbar completely */
  .scrollbar-none {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  .scrollbar-none::-webkit-scrollbar {
    display: none;
  }

  /* Thin scrollbar (mobile default) */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--muted-foreground) / 0.3) transparent;
  }
  
  .scrollbar-thin::-webkit-scrollbar {
    width: 4px;
    height: 4px;
  }
  
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background: hsl(var(--muted-foreground) / 0.3);
    border-radius: 20px;
  }

  /* DESKTOP CUSTOM LOOK */
  @media (min-width: 768px) {
    .scrollbar-custom {
      scrollbar-width: thin;
      scrollbar-color: hsl(var(--primary) / 0.4) transparent;
    }

    .scrollbar-custom::-webkit-scrollbar {
      height: 8px;
      width: 8px;
    }

    .scrollbar-custom::-webkit-scrollbar-track {
      background: transparent;
    }

    .scrollbar-custom::-webkit-scrollbar-thumb {
      background: linear-gradient(
        135deg,
        hsl(var(--primary) / 0.5),
        hsl(var(--primary) / 0.2)
      );
      border-radius: 9999px;
      border: 1px solid hsl(var(--border) / 0.3);
    }

    .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(
        135deg,
        hsl(var(--primary) / 0.6),
        hsl(var(--primary) / 0.3)
      );
    }
  }
}

/* ========================================================================== */
/* COMPONENT STYLES                                                          */
/* ========================================================================== */

@layer components {
  /* Glass buttons */
  .glass-button {
    -webkit-backdrop-filter: blur(12px);
    backdrop-filter: blur(12px);
    transition: all 0.3s ease;
    border-radius: var(--radius);
    padding: 0.5rem 1rem;
    font-weight: 500;
    min-width: 100px;
    text-align: center;
    white-space: nowrap;
    background: hsl(var(--background) / 0.75);
    border: 1px solid hsl(var(--border) / 0.25);
    color: hsl(var(--foreground));
    transform: translateY(0) scale(1);
    position: relative;
    overflow: hidden;
  }

  .glass-button:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 
      0 8px 25px rgba(0, 0, 0, 0.15),
      0 4px 6px -1px rgba(0, 0, 0, 0.1);
    border-color: hsl(var(--border) / 0.4);
  }

  .glass-button:active {
    transform: translateY(0) scale(0.98);
  }

  .glass-button:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 2px;
  }

  /* Glass gradient header */
  .glass-gradient-header {
    position: relative;
    overflow: hidden;
    border-radius: calc(var(--radius) + 4px);
    background: hsl(var(--background) / 0.8);
    -webkit-backdrop-filter: blur(20px) saturate(150%);
    backdrop-filter: blur(20px) saturate(150%);
  }
}

/* ========================================================================== */
/* ANIMATIONS & EFFECTS                                                      */
/* ========================================================================== */

@layer utilities {
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeIn 0.3s ease-out;
  }

  @keyframes ping {
    75%, 100% {
      transform: scale(2);
      opacity: 0;
    }
  }

  .animate-ping {
    animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
  }

  @keyframes shimmer {
    0% {
      transform: translateX(-150%) skewX(-30deg);
    }
    100% {
      transform: translateX(150%) skewX(-30deg);
    }
  }

  @keyframes searchPulse {
    0% {
      background-color: rgba(59, 130, 246, 0.1);
    }
    50% {
      background-color: rgba(59, 130, 246, 0.3);
    }
    100% {
      background-color: rgba(59, 130, 246, 0.1);
    }
  }

  .search-highlight-pulse {
    animation: searchPulse 2s ease-in-out;
  }
}

/* ========================================================================== */
/* DRAWER FIXED CONTAINER                                                    */
/* ========================================================================== */

#drawer-fixed-container {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 26vh;
  max-height: 26vh;
  min-height: 26vh;
  transform: translateY(0) !important;
  touch-action: none;
}

/* ========================================================================== */
/* RESPONSIVE ADJUSTMENTS                                                    */
/* ========================================================================== */

@layer utilities {
  @media (max-width: 1024px) {
    .glass-button {
      min-width: 90px;
      padding: 0.45rem 0.9rem;
      font-size: 0.9rem;
    }
  }

  @media (max-width: 768px) {
    .glass-button {
      min-width: 80px;
      padding: 0.4rem 0.8rem;
      font-size: 0.875rem;
    }
  }

  @media (max-width: 480px) {
    .glass-button {
      min-width: 70px;
      padding: 0.35rem 0.7rem;
      font-size: 0.85rem;
    }
    
    .message-container {
      padding: 0.5rem;
    }
    
    .search-info-bar {
      font-size: 0.875rem;
      padding: 0.75rem 1rem;
    }
  }
}